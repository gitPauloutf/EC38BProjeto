const mongoose = require("mongoose")

const UserSchema = new mongoose.Schema({
        usr: String,
        name: String,
        pw: String,
        isAdmin: String
    })
const UserModel = mongoose.model("User", UserSchema)

async function getByName(nome) {
    return await UserModel.findOne({name: nome}).lean()
}

async function getByUsr(nome) {
    return await UserModel.findOne({usr: nome}).lean()
}


module.exports = {
    getByName, getByUsr,

    log: async function(usr,pw){
        obj = await getByUsr(usr)
        if (!obj) {
            console.log("User not found")
            return 0
        }
        if (obj.pw!=pw) {
            console.log("Wrong password")
            return 0
        }
        return {usr: obj.usr,name: obj.name,isAdmin: obj.isAdmin}
    },
    reg: async function(usr,name,pw){
        obj = await getByUsr(usr) 
        if (!obj) {
            obj = await getByName(name)
            if (!obj) {
                const user = new UserModel({
                    usr : usr,
                    name : name,
                    pw : pw,
                    isAdmin: 'Usuario'
                })
                if (usr=='admin') user.isAdmin = 'Admin'
                await user.save()
                return 1
            } else {console.log("Name already exists")
                return 0}
        }
        console.log("User already exists")
        return 0
    }
}